---
# File for ansible-role-test (https://github.com/aeriscloud/ansible-role-test)
name: "Debian tests"
playbook:
- hosts: all
  sudo: yes
  roles:
  - role: "@ROLE_NAME@"
    repositories:
      wheezy:
      - elasticsearch
      - mongodb
      jessie:
      - elasticsearch
      - mongodb
  tasks:
  - name: "Check that elasticsearch is available on Debian"
    command: apt-cache show elasticsearch
    register: result
    ignore_errors: yes
    when: ansible_distribution == 'Debian'
  - fail: "elasticsearch should be available with --enablerepo"
    when: "ansible_distribution == 'Debian' and result['rc'] != 0"

  - name: "Check that mongodb is available on Debian"
    command: apt-cache show elasticsearch
    register: result
    ignore_errors: yes
    when: ansible_distribution == 'Debian'
  - fail: "elasticsearch should be available"
    when: "ansible_distribution == 'Debian' and result['rc'] != 0"
